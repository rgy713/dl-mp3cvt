function isIos(){var t=!1,e=(navigator.userAgent||navigator.vendor||window.opera).toLowerCase();return/ip(ad|hone|od)/.test(e)&&(t=!0),t}function convert(t){var e,n=$("#csrf_token").html()+"<input type='hidden' name='file_name' value='"+t+"' /><input type='hidden' name='isIos' value='"+isIos()+"' />";e=$("<form id='id_file_convert'>").appendTo("body"),e.hide().prop("method","POST").html(n),e.submit().remove()}$(".dy-row").addClass("convert-content"),$("body").css("overflow-y","hidden"),$(".dy-loader").css({position:"absolute","margin-top":"50px"}),$("#id_file").change(function(){$("#id-convert").submit()});var allowedExtensions=["mp4","avi","mpg","flv","mov","mp3","flac","aac","m4a","3gp","3g2","asf","m4v","mkv","ogg","wmv","wav","wma","webm"],maxSize=3221225472,XHR;$(document).on("click",".ajax-file-upload",function(t){"停止"==$("#upload_btn_txt").html()&&(XHR.abort(),$("#upload_btn_txt").html("ファイルを選択"),$(".dy-loader").css("display","none"),t.preventDefault(),$("#id_file").css("display","inherit"),$("#id_file").val(null))}),$(document).on("submit","form#id-convert",function(t){var e=$("#id_file"),n=$(".dy-loader");if(null!==e.val()&&""!==e.val()){var i=e.val().split(".").pop().toLowerCase(),o=e.val().split("\\").pop();if(-1===$.inArray(i,allowedExtensions))return n.html(o+"には対応していません。"),n.css("display","inherit"),t.preventDefault(),!1;var l=e[0].files[0].size;if(l>maxSize)return n.html(l+"bites には対応していません。"),n.css("display","inherit"),t.preventDefault(),!1;$("#upload_btn_txt").html("停止"),n.html("アップロード中"),n.css("display","inherit");var a=$("#id-convert")[0],s=new FormData(a);return s.append("file",e[0].files[0]),e.css("display","none"),XHR=$.ajax({url:"/mp3_convert/convert/",type:"POST",processData:!1,contentType:!1,data:s,success:function(t){"S_OK"==t.type?(n.html("変換中"),convert(t.content.fileName)):"FAIL"==t.type&&($("#upload_btn_txt").html("ファイルを選択"),n.html(o+"には対応していません。"),e.css("display","inherit"))},error:function(){$("#upload_btn_txt").html("ファイルを選択"),n.html(o+"には対応していません。"),e.css("display","inherit")}}),t.preventDefault(),!1}}),$(document).on("submit","form#id_file_convert",function(t){var e=$("#id_file"),n=$(".dy-loader"),i=e.val().split("\\").pop();return isIos()?XHR=$.ajax({url:"/mp3_convert/convert/",type:"POST",data:$(this).serialize(),dataType:"json",success:function(t){"S_OK"==t.type?($("#upload_btn_txt").html("ファイルを選択"),window.location.href=t.content.videoUrl,n.css("display","none"),e.css("display","inherit")):"FAIL"==t.type&&($("#upload_btn_txt").html("ファイルを選択"),n.html(i+"には対応していません。"),e.css("display","inherit"))},error:function(){$("#upload_btn_txt").html("ファイルを選択"),n.html(i+"には対応していません。"),e.css("display","inherit")}}):$.fileDownload("/mp3_convert/convert/",{successCallback:function(t){console.log(t),$("#upload_btn_txt").html("ファイルを選択"),n.css("display","none"),e.css("display","inherit")},failCallback:function(t,o){console.log(t),console.log(o),$("#upload_btn_txt").html("ファイルを選択"),n.html(i+"には対応していません。"),e.css("display","inherit")},httpMethod:"POST",data:$(this).serialize()}),t.preventDefault(),!1});